{% extends "base.html" %}

{% load humanize %}
{% load if_extra %}

{% block title %}View Application{% endblock %}

{% block content %}
<h3>Application Details</h3>

<ul>
<li>Applying Auth User: <a href="{% url sso.views.user_view app.user %}">{{ app.user }}</a></li>
<li>Applying Character: {{ app.character }} <button type="button" onclick="CCPEVE.showInfo('1377//{{ app.character.id }}')">Show In Eve</button></li>
<li>Application Status: <b>{{ app.get_status_display }}</b></li>
<li>Blacklist Status: <b>{% if app.blacklisted %}<span color='red'>BLACKLISTED</span>{% else %}OK{% endif %}</b></li>
</ul>

{% ifnotequal app.status 5 %}
<h3>Actions</h3>
<p>
{% if app.status < 1 %}
<a href="{% url hr.views.update_application app.id 1 %}">Submit Application</a>,&nbsp;
{% else %}
<a href="{% url hr.views.update_application app.id 0 %}">Withdraw Application</a>,&nbsp;
{% endif %}
<a href="{% url hr.views.add_message app.id %}">Add Message</a>,
{% if hrstaff %}
<a href="{% url hr.views.add_note app.id %}">Add Staff Note</a>,&nbsp;
{% if app.status < 2 or app.status = 4 %}
<a href="{% url hr.views.reject_application app.id %}">Reject Application</a>,&nbsp;
{% ifequal app.blacklisted 0 %}
<a href="{% url hr.views.accept_application app.id %}">Accept Application</a>,&nbsp;
{% endifequal %}
{% ifnotequal app.status 4 %}
<a href="{% url hr.views.update_application app.id 4 %}">Mark as In Query</a>,&nbsp;
{% endifnotequal %}
{% endif %}
{% ifequal app.status 3 %}
<a href="{% url hr.views.update_application app.id 5 %}">Mark as Complete</a>,&nbsp;
{% endifequal %}
{% endif %}
{% endifnotequal %}
</p>

{% if audit %}
<h3>Event Log</h3>
<table>
<tr><th>Event Type</th><th>User</th><th>Date</th><th>Event Details</th></tr>
{% for a in audit %}
<tr><td>{{ a.get_event_display }}</td><td>{{ a.user }}</td><td>{{ a.date }}</td><td>{{ a.text }}</td></tr>
{% endfor %}
</table>
{% endif %}

{% if app.blacklisted %}
<h3>Blacklist Triggers</h3>
<table>
<tr><th>Blacklist Type</th><th>Blacklisted Value</th><th>Reason</th></tr>
{% for a in app.blacklist_values %}
<tr><td>{{ a.get_type_display }}</td><td>{{ a.value }}</td><td>{{ a.reason }}</td></tr>
{% endfor %}
</table>
{% endif %}

{% if recs %}
<h3>Recommendations</h3>
<ul>
{% for rec in recs %}
<li><a href="{% url sso.views.user_view rec.user %}">{{ rec.user }}</a> / {{ rec.user_character }} - {{ rec.user_character.corporation }}</li>
{% endfor %}
</ul>
{% endif %}

{% if hrstaff %}
<h3>EVE Characters</h3>
<ul>

<table>
<tr><th>Character</th><th>Corp / Alliance</th></th><th>ISK</th><th>SP</th><th>Links</th></tr>
{% for acc in app.user.eveaccount_set.all %}
{% for char in acc.characters.all %}
<tr><td><a href="{% url sso.views.characters char.id %}">{{ char.name }}</a></td>
    <td>{{ char.corporation }} / {{ char.corporation.alliance }}</td>
    <td>{{ char.balance|intcomma }} ISK</td>
    <td>{{ char.total_sp|intcomma }} SP</td>
    <td><button type="button" onclick="CCPEVE.showInfo('1377//{{ char.id }}')">Show In Eve</button> / <a href="https://gate.eveonline.com/Profile/{{ char.name }}/">EveGate Profile</a></td>
</tr>
{% endfor %}
{% endfor %}
</ul>

{% if app.user.redditaccount_set.all %}
<h3>Reddit Accounts</h3>
<table>
<tr><th>Account</th><th>Karma</th><th>Validated</th><th>Creation Date</th></tr>
{% for acc in app.user.redditaccount_set.all %}
<tr><td><a href="http://reddit.com/user/{{ acc.username }}/">{{ acc.username }}</a></td>
    <td>{{ acc.link_karma }} / {{ acc.comment_karma }}</td>
    <td>{% if acc.validated %}Validated{%else %}<b>NOT VALIDATED</b>{% endif %}</td>
    <td>{{ acc.date_created }}</td>
</tr>
{% endfor %}
</table>

<h3>Reddit Posts</h3>
<ul>
{% if reddit_error %}
<p><b>{{ reddit_error }}</b></p>
{% endif %}
{% for post in posts %}
{% ifnotequal post.kind 1 %}
<p><b><a href="http://reddit.com{{ post.permalink }}">{{ post.title }}</a></b> - (/r/{{ post.subreddit }})</p>
{% else %}
<p>{{ post.body }} - (/r/{{post.subreddit}}) <a href="{{ post.permalink }}/">Permalink</a></p>
{% endifnotequal %}
{% endfor %}
</ul>
{% endif %}
{% endif %}
{% endblock %}
